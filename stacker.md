[TOP](./README.md)


# Stackerの開発メモ

<hr>

## github
https://github.com/remokasu/stacker

<hr>

## PyPI
https://pypi.org/project/pystacker/

<hr>

## 予定
- ~~プラグイン機能の追加~~(2023-04/22 完了)
- テストケース
- シンタックスカラーリング
- エラーハイライティング
    * 例えばipython
    ~~~ python
    In [1]: [1,2,3
    ...: 4,5,6]
    Input In [1]
        [1,2,3
            ^
    SyntaxError: invalid syntax. Perhaps you forgot a comma?
    ~~~
- 出力の色はユーザーが変えられるように
- プラグインのインストール方法を簡単に -> プラグインインストールコマンド
- スクリプトファイルの実行(簡易的なものは実装済み)
- 分岐とループ


<hr>

## バグ
1. 数値に代入できる
    これは、内部では変数をすべて辞書型で管理しているため、`{5:10}`ということが発生している。<br>
    修正は簡単だけど、なんとなく面白いので放置しておく。

2. タプル入力が色々と怪しい．

3. `'1 + 1' eval` のような入力をしたとき、`'1 + 1'` と `eval` に分割されるべきだが、連続した文字列となる。
    そもそもパーサーが妙なので、ちゃんと作り直したほうがいい

<hr>

## 仮実装した機能など。実装済みだが、仕様変更の可能性あり。
1. Block Stack: <br> 
    `{...}`の範囲は遅延評価する。この範囲が一つのtokenとして扱われる。この機能を仮に`block stack`とする。
    関数定義や、長い式の可視性の向上に役立つ。が、RPNの概念から少し外れる気がする。
2. 関数定義: <br>
    元々、仮実装していた構文は `x y myfunc => x y *` のような記法だが、BlockStackを用いて
    `(x y) {x y *} myfunc fn` とした。`fn`は関数定義を表す予約語で、`myfunc`は関数名. <br>
    式がRPN的に若干妙な気もするが...。どうしたものか？<br>
    `(x y) {x y *} fn myfunc set` だろうか？解釈次第？
3. 変数定義:<br>
    元々、`a = 1` のような記法だったが、`1 a set` とした。
<hr>

## plugins
本体とは別に更新していくスタイルで．<br>
(https://github.com/remokasu/stacker-plugins)

### 単位変換プラグインを作成．コマンドが少々使いにくい．
* 入力
    ~~~ bash
    > m/s 10 km/h cu
    ~~~
    cu: convert unit

* 順番を変える？こうすると使いやすいかも(?)
    ~~~ bash
    > 10 km/h m/s cu
    ~~~

* あるいは cu は省略してもいいかも．
    ~~~ bash
    > 10 km/h m/s
    ~~~

* 単位増やしすぎると他の予約語と被りそう

<br>

### 一部のシェルコマンドを実行できるプラグインを追加．<br>
* `vim`と入力するとフリーズする問題を修正．インタラクティブなコマンドは打ち込めないようにするべきか．そもそもこれは電卓なのであり...(2023-04-29)

<br>

## その他
* `stacker`の名前は既に使用されており、不服ながら登録名は`pystacker`に。パッケージ名は`stacker`のまま。

* なんでRPNなのに代入構文だけ中置記法(例) `x = 2` にしてしまったんだろう...?<br>
そもそもRPNで代入とはいつたい?<br>
かといって、`2 x =`という記述はキモすぎるが.<br>
`2 x assign` とかにするか...?
* `exec`は廃止する．（プラグインでいろいろできるので．）
* 正規表現でいろいろ詰まった．判定の優先順位を意識しないと危険．
* stack内のlistの要素にアクセスする方法?
