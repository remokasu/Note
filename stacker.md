[TOP](./README.md)


# Stackerの開発メモ

<hr>

## github
https://github.com/remokasu/stacker

<hr>

## PyPI
https://pypi.org/project/pystacker/

<hr>

## 予定
- ~~プラグイン機能の追加~~(2023-04/22 完了)
- テストケース
- シンタックスカラーリング
- エラーハイライティング
    * 例えばipython
    ~~~ python
    In [1]: [1,2,3
    ...: 4,5,6]
    Input In [1]
        [1,2,3
            ^
    SyntaxError: invalid syntax. Perhaps you forgot a comma?
    ~~~
- スクリプトファイルの実行(簡易的なものは実装済み)
- 分岐とループ


<hr>

## バグ
1. 数値に代入できる
    ~~~ bash
    stacker:0> 5 = 10
    5 10
    Variable '5' assigned with value 10: 10
    stacker:1> 5 5 *
    [100]
    ~~~
    これは、内部では変数をすべて辞書型で管理しているため、`{5:10}`ということが発生している。<br>
    修正は簡単だけど、なんとなく面白いので放置しておく。

<br>

2. タプル入力が色々と怪しい．

3. 関数定義，変数代入，演算　それぞれで構文解析の処理が異なる.<br>
    * → リストの解析が演算時のみ異なる．[1 2 3; 4 5 6]のような記法が使えるのは演算時のみ．<br>
    代入ではPython式記法しか使えない．<br>

<hr>

## plugins
本体とは別に更新していくスタイルで．<br>
(https://github.com/remokasu/stacker-plugins)

### 単位変換プラグインを作成．コマンドが少々使いにくい．
* 入力
    ~~~ bash
    > m/s 10 km/h cu
    ~~~
    cu: convert unit

* 順番を変える？こうすると使いやすいかも(?)
    ~~~ bash
    > 10 km/h m/s cu
    ~~~

* あるいは cu は省略してもいいかも．
    ~~~ bash
    > 10 km/h m/s
    ~~~

* 単位増やしすぎると他の予約語と被りそう

<br>

### 一部のシェルコマンドを実行できるプラグインを追加．<br>
* `vim`と入力するとフリーズする問題を修正．インタラクティブなコマンドは打ち込めないようにするべきか．そもそもこれは電卓なのであり...(2023-04-29)

<br>

### 行列演算
* 入力の改善
    * 多次元配列の入力が面倒くさい
        ~~~
        stacker > [[1,2],[3,4], [5,6]] 
        ~~~
        ので，こういう形式で入力できるようにしたい．入力の変更はstacker本体側
        ~~~
        stacker > [1 2; 3 4; 5 6]
        ~~~
    * 従来のPython形式リスト入力は出来ないようにする．ただし，暫定的．何れはどちらも入力可能としたい．
    * size, shape, ndim などの結果はstackするべきか否か？
<hr>

## その他
* `stacker`の名前は既に使用されており、不服ながら登録名は`pystacker`に。パッケージ名は`stacker`のまま。

* なんでRPNなのに代入構文だけ中置記法(例) `x = 2` にしてしまったんだろう...?<br>
そもそもRPNで代入とはいつたい?<br>
かといって、`2 x =`という記述はキモすぎるが.<br>
`2 x assign` とかにするか...?
* `exec`は廃止する．（プラグインでいろいろできるので．）
* 正規表現でいろいろ詰まった．判定の優先順位を意識しないと危険．
* stack内のlistの要素にアクセスする方法?
